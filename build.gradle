plugins {
  id 'idea'
  id 'com.bmuschko.docker-remote-api' version '4.9.0' apply false
}

 allprojects {
   repositories {
       mavenLocal()
       mavenCentral()
       maven { url "https://jcenter.bintray.com" }
       maven { url "https://oss.sonatype.org/content/repositories/snapshots" }
       jcenter() // or Maven central, required for Lombok dependency
   }
 }

configure(subprojects.findAll {it.name.contains("docker")}) {
  apply plugin: 'com.bmuschko.docker-remote-api'
  docker {
    registryCredentials {
      url = 'https://docker.repo.strapdata.com'
      username = registryUsername
      password = registryPassword
      email = registryEmail
    }
  }
}

task dockerBuild {
  dependsOn ':java:operator:jibDockerBuild'
  dependsOn ':java:sidecar:jibDockerBuild'
  dependsOn ':docker:dockerBuildImage'
}

task dockerPush {
  dependsOn ':java:operator:jib'
  dependsOn ':java:sidecar:jib'
  dependsOn ':docker:dockerPushImage'
}

